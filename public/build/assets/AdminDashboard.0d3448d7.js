import{V as F,W as O,r as k,y as E,Y as h,al as H,g as x,o as L,e as Q,w as d,a as y,b as u,U as B,K as R,X as S,p as $,I as V,a8 as G}from"./app.c248d67c.js";import{_ as W}from"./AppLayout.4269b78a.js";import{_ as Y}from"./Wizard.beb70cf6.js";import q from"./StepCustomer.f760499b.js";import K from"./StepPeople.a83929e2.js";import U from"./StepPrimaryHairService.bb692dd2.js";import X from"./StepUpdo.e6de0974.js";import J from"./StepAddons.24fab4a1.js";import Z from"./StepCalendar.19607a9c.js";import ee from"./StepCheckout.db6192a3.js";import te from"./StepSuccess.8b5be197.js";import ae from"./AdminBookingSidebar.dec3c03b.js";import{u as se}from"./wizardStore.2226bc2a.js";import"./Logo.d971df1b.js";import"./menu.6da08311.js";import"./ChevronDownIcon.f3847a45.js";import"./CheckIcon.5f685430.js";import"./XIcon.0ce515ba.js";import"./Checkbox.be985f5e.js";import"./PeopleCountInput.0f187a21.js";import"./ClockIcon.a6d9947b.js";import"./VueTimepikcer.esm.6176b535.js";import"./CheckoutCharge.1cfb124f.js";import"./PencilIcon.722a49e8.js";const ie={class:"flex justify-start items-center mt-4 mb-6"},oe={class:"flex flex-wrap gap-6"},re={class:"flex-1"},Me={__name:"AdminDashboard",props:{store_id:Number,washing_stations:Number,stores_list_wizard:Object,customers:Object,originalBooking:{type:Object,default:null},primaryHairServices:{type:Array,default:null},addonHairServices:{type:Object,default:null},customer_id:{type:Number,default:null}},setup(D){const c=D,g=se(),{activeStep:b,isStepCheckout:le,wizardSelection:t,wizardGeneral:s,people:p,wizardLoadBooking:ne,ready:ue,totalReady:v,wizardFetchData:ce}=F(g),j=O().props.value.primaries_not_included,w=k(null),z=k(!1);k(!0),E(()=>{h.lg(c.originalBooking),P(),s.value.stores=c.stores_list_wizard,c.customer_id&&(t.value.customer_id=c.customer_id),c.originalBooking?g.wizardLoadBooking(c.originalBooking):t.value.store_id=c.store_id,t.value.washing_stations=c.washing_stations,g.wizardFetchData("step_store"),s.value.customers=c.customers,I()});async function I(){const a=await H.get(route("booking.payment-infos"));a.data&&(s.value.payment_infos=a.data)}function P(){g.$reset()}function A(){z.value=!0}function N({update:a}){v.value=!1,S.Inertia.post(route("booking.infos"),{...t.value,...s.value,people:p.value},{preserveScroll:!0,preserveState:!0,onSuccess:r=>{s.value.booking_infos={...s.value.booking_infos,...r.props.flash.data},b.value.name==="step_calendar"&&S.Inertia.post(route("booking.hair-services.check-availability"),{...s.value,...t.value,people:p.value},{preserveScroll:!0,preserveState:!0,onSuccess:e=>{const{days:i,infos:n}=e.props.flash.data;if(s.value.booking_infos={...s.value.booking_infos,...n},t.value.available_days=i,t.value.selected_day){const l=t.value.available_days.find(o=>o.date===t.value.selected_day.date&&o.available);if(t.value.selected_day=l!=null?l:null,t.value.selected_slot&&l){const o=l.slots.find(m=>m.time===t.value.selected_slot.time&&m.available);h.lg(o),t.value.selected_slot=o!=null?o:null}else t.value.selected_slot=null}else t.value.selected_day=null,t.value.selected_slot=null;if(t.value.selected_day===null){let l=t.value.available_days.find(o=>o.available);if(l){h.lg("SET DAY 2"),t.value.selected_day=l;let o=t.value.selected_day.slots.find(m=>m.available);o&&(t.value.selected_slot=o)}}a()},onFinish:()=>{v.value=!0}}),b.value.name==="step_checkout"&&(s.value.discount_code?S.Inertia.post(route("booking.discount.check"),{...s.value,...t.value,people:p.value},{preserveScroll:!0,preserveState:!0,onSuccess:e=>{var o,m;const i=(o=e.props.flash)==null?void 0:o.data,n=i==null?void 0:i.discount,l=(m=i==null?void 0:i.errors)!=null?m:[];s.value.discount=n,s.value.discount_errors=l,s.value.booking_infos.discount=n,n&&(s.value.booking_infos.actual_net_price=n.discounted_price,a())},onFinish:()=>{v.value=!0}}):v.value=!0),a()},onFinish:()=>{b.value.name!=="step_calendar"&&b.value.name!=="step_checkout"&&(v.value=!0)}})}const C=x(()=>{let a=[{name:"step_customer",title:"Scegli il cliente"},{name:"step_people",title:"Per chi vuoi prenotare?"},{name:"step_primary_hair_service",title:"Quale servizio vuoi prenotare?"},{name:"step_updo",title:"Quali raccolti vuoi aggiungere?"},{name:"step_addons",title:"Quali add-on vuoi aggiungere?"}];return a=a.concat([{name:"step_calendar",title:"Quando vuoi venire?",onBeforeShow:()=>t.value.store_id,onShow:()=>{t.value.available_days=null}},{name:"step_checkout",title:c.originalBooking?"Conferma le modifiche":"Procedi all\u2019acquisto per concludere la prenotazione",onBeforeShow:()=>!!(t.value.store_id&&t.value.selected_day&&t.value.selected_slot)}]),a}),M=x(()=>{let a=[{title:"Chi",wizardStep:"step_customer"},{title:"Numero persone",wizardStep:"step_people"},{title:"Servizi",wizardStep:"step_primary_hair_service"},{title:"Raccolti",wizardStep:"step_updo"},{title:"Add-on",wizardStep:"step_addons"}];return a=a.concat([{title:"Orario",wizardStep:"step_calendar"},{title:"Checkout",wizardStep:"step_checkout"}]),a});function f(a){var r,e;switch(a){case"step_customer":return t.value.customer_id?s.value.customers[t.value.customer_id]:"-";case"step_primary_hair_service":return"-";case"step_people":return t.value.multiple&&p.value.length>0?p.value.length+" persone":"Solo tu";case"step_updo":return"-";case"step_addons":return"-";case"step_calendar":return t.value.selected_day,t.value.selected_slot?G(`${(r=t.value.selected_day)==null?void 0:r.date} ${(e=t.value.selected_slot)==null?void 0:e.time}`).format("ddd DD MMMM, HH:mm"):"-"}}$("getMenuItemData",f);function T(a){let r=[];switch(a){case"step_customer":return[{title:"",data:[{title:f(a)}]}];case"step_store":return[{title:"",data:[{title:f(a)}]}];case"step_people":return[{title:"",data:[{title:f(a)}]}];case"step_primary_hair_service":return _.forEach(p.value,e=>{var i,n;r.push({title:e.name===0?"Tu":"Amica "+e.name,data:[{title:e.primary_service?e.primary_service.title+"("+e.primary_service.execution_time+"')":null,price:e.primary_service?(i=e.primary_service)==null?void 0:i.net_price:null,discounted:e.name===0&&s.value.subscribed&&!j.includes((n=e.primary_service)==null?void 0:n.title)}]})}),r;case"step_updo":return _.forEach(p.value,e=>{r.push({title:e.name===0?"Tu":"Amica "+e.name,data:[{title:e.addons.updo.length>0?e.addons.updo[0].title+"("+(e.addons.updo[0].extra===!0?0:e.addons.updo[0].execution_time_fe)+"')":null,price:e.addons.updo.length>0?e.addons.updo[0].net_price:null,discounted:e.name===0&&s.value.subscribed,discountedPrice:e.name===0&&s.value.subscribed&&e.addons.updo.length>0?e.addons.updo[0].net_price_discounted:null}]})}),r;case"step_addons":return _.forEach(p.value,e=>{let i=[],n=[],l=[];e.addons.massage.length>0&&(i.push(e.addons.massage[0].title+"("+(e.addons.massage[0].extra===!0?0:e.addons.massage[0].execution_time_fe)+"')"),n.push(e.addons.massage[0].net_price),l.push(h.printPrice(e.addons.massage[0].net_price_discounted))),e.addons.treatment.length>0&&(i.push(e.addons.treatment[0].title+"("+(e.addons.treatment[0].extra===!0?0:e.addons.treatment[0].execution_time_fe)+"')"),n.push(e.addons.treatment[0].net_price),l.push(h.printPrice(e.addons.treatment[0].net_price_discounted))),r.push({title:e.name===0?"Tu":"Amica "+e.name,data:[{title:i.join(", "),price:n.join("\u20AC, "),discounted:e.name===0&&s.value.subscribed,discountedPrice:e.name===0&&s.value.subscribed?l.join("\u20AC "):null}]})}),r;case"step_calendar":return[{title:"",data:[{title:f(a)}]}];default:return[]}}return $("getSidebarData",T),(a,r)=>{const e=V("bb-back-link");return L(),Q(W,{title:"Booking admin","show-title":!1},{default:d(()=>[y("div",ie,[u(e)]),y("div",oe,[u(ae,{onGoTo:r[0]||(r[0]=i=>w.value.goToStepByName(i)),"menu-items":B(M)},null,8,["menu-items"]),y("div",re,[u(Y,{ref_key:"wizard",ref:w,steps:B(C),showCallback:N,onLinkSent:A,class:"w-full px-6"},{title:d(({title:i})=>[y("h2",null,R(i),1)]),step_customer:d(()=>[u(q)]),step_people:d(()=>[u(K)]),step_primary_hair_service:d(()=>[u(U)]),step_updo:d(()=>[u(X)]),step_addons:d(()=>[u(J)]),step_calendar:d(()=>[u(Z)]),step_checkout:d(()=>[u(ee,{"no-stripe":!0})]),step_success:d(()=>[u(te,{"payment-link-sent":z.value},null,8,["payment-link-sent"])]),_:1},8,["steps"])])])]),_:1})}}};export{Me as default};
