import{g as C,r as d,o as l,e as I,w as o,W as Y,a as s,b as n,U as r,ag as z,a4 as E,K as g,Q as T,c as i,a8 as f,q as j,S as k,X as N,Y as y,I as b}from"./app.c248d67c.js";import{_ as U}from"./AppLayout.4269b78a.js";import{r as M,B as Q}from"./Table.94a0e2ae.js";import{B as $}from"./SearchInput.2608ef07.js";import{u as F}from"./search.181f2eee.js";import"./Logo.d971df1b.js";import"./wizardStore.2226bc2a.js";import"./menu.6da08311.js";import"./ChevronDownIcon.f3847a45.js";import"./CheckIcon.5f685430.js";import"./XIcon.0ce515ba.js";import"./PencilIcon.50f1eb3f.js";import"./RefreshIcon.6547917e.js";const K={class:"flex justify-between mb-4"},L={class:"w-1/2"},O=["href"],P={class:"bb-card"},R={key:0},W={key:1},X={key:2},G={key:1},H=k(" Annulla abbonamento "),J=s("p",null,"Sei sicuro di voler eliminare questo abbonamento?",-1),Z=s("br",null,null,-1),ee=s("p",null,"Scegli una modalit\xE0 di cancellazione",-1),te=k(" Annulla abbonamento "),me={__name:"Index",props:{models:Object},setup(h){C(()=>Y().props.value.role);const{searchQuery:_,isSearching:B}=F("subscription.index"),p=d(null),v=d(null),m=d(!1),u=d("now");function A(a,t){switch(a){case"delete":v.value=t,u.value="now",p.value.open();break}}function w(){m.value=!0,N.Inertia.delete(route("subscription.destroy",v.value.id),{data:{method:u.value},onSuccess:a=>{p.value.close(),m.value=!1,y.flash({type:"success",message:"Abbonamento annullato"})},onError:()=>{y.flash({type:"error",message:"Si \xE8 verificato un errore durante la cancellazione dell' abbonamento"})}})}function D(a){let t=`${a.duration_qty} `;switch(a.duration_type){case"month":return a.duration_qty==1?t+="mese":t+="mesi";case"year":return a.duration_qty==1?t+="anno":t+="anni"}}function c(a){return f(a.ends_at)<f()}return(a,t)=>{const S=b("bb-button"),V=b("bb-radio-group"),q=b("BbButton"),x=b("BbDialog");return l(),I(U,{title:"Abbonamenti acquistati"},{default:o(()=>[s("div",K,[s("div",L,[n($,{searching:r(B),modelValue:r(_),"onUpdate:modelValue":t[0]||(t[0]=e=>z(_)?_.value=e:null)},null,8,["searching","modelValue"])]),s("a",{href:a.route("subscription.export")},[n(S,{type:"button"},{default:o(()=>[n(r(M),{class:"w-6 h-6"})]),_:1})],8,O)]),s("div",P,[n(Q,{collection:h.models.data,columns:[{slot:"customer",label:"Cliente"},{key:"user.email",label:"Email"},{key:"plan.name",label:"Abbonamento"},{key:"created_at",label:"Acquistato il",format:"date"},{computed:e=>e!=null&&e.pricing?D(e.pricing):"-",label:"Durata"},{slot:"stripe_status",label:"Status"}],links:h.models.links,actions:[{name:"delete",condition:e=>!e.ends_at}],onAction:t[1]||(t[1]=e=>A(e.action,e.item))},{customer:o(({item:e})=>[n(r(E),{href:a.route("customer.show",e.user.id),class:"underline"},{default:o(()=>[s("strong",null,g(e.user.full_name),1)]),_:2},1032,["href"])]),stripe_status:o(({item:e})=>[s("span",{class:T({"bb-badge-success":e.stripe_status=="active"&&!e.ends_at,"bb-badge-warning":e.stripe_status=="active"&&e.ends_at&&!c(e),"bb-badge-danger":e.ends_at&&c(e),"bb-badge-secondary":e.stripe_status!="active"})},[e.stripe_status=="active"?(l(),i(j,{key:0},[e.ends_at&&!c(e)?(l(),i("span",R," Attivo fino al "+g(r(f)(e.ends_at).format("DD/MM/YYYY")),1)):e.ends_at&&c(e)?(l(),i("span",W," Annullato ")):(l(),i("span",X,"Attivo"))],64)):(l(),i("span",G,"Annullato"))],2)]),_:1},8,["collection","columns","links","actions"])]),n(x,{ref_key:"deleteDialog",ref:p,type:"plain",size:"md"},{title:o(()=>[H]),buttons:o(()=>[n(q,{danger:"",disabled:m.value,onClick:w},{default:o(()=>[te]),_:1},8,["disabled"])]),default:o(()=>[J,Z,ee,n(V,{class:"py-2",modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),vertical:!0,options:[{value:"now",label:"Istantaneamente"},{value:"normal",label:"Al prossimo rinnovo"}]},null,8,["modelValue"])]),_:1},512)]),_:1})}}};export{me as default};
