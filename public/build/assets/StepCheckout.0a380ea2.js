import{o,e as w,b,_ as ie,c as i,a as s,V as ne,W as le,r as M,g as R,U as e,w as m,L as c,q as y,K as n,S as f,a9 as L,Y as u,X as ae,I as V,Q as I,a8 as de,J as N,E}from"./app.45a2e0de.js";import{_ as ce,a as re}from"./CheckoutCharge.2953de59.js";import{u as ue}from"./wizardStore.ef397de9.js";function _e(z,x){return o(),w("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[b("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])}const be={},fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor","aria-hidden":"true"},pe=s("path",{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},null,-1),me=[pe];function ve(z,x){return o(),i("svg",fe,me)}var he=ie(be,[["render",ve]]);const xe=s("p",{class:"font-bold text-white mb-3"},"Hai un codice sconto?",-1),ge={class:"mb-3"},ye={key:0},ke={key:0,class:"text-xs text-bb-danger-200 my-1"},we={class:"flex justify-end"},Ce=f(" Applica sconto "),Se={key:1,class:"text-white flex items-center space-x-1"},ze=f(" Codice applicato: "),je={class:"mt-2 mb-4"},De=s("p",{class:"text-xs text-[#BADFF7]"},"Stai prenotando per il",-1),Pe={class:"text-lg font-bold text-white"},Ve={class:"text-bb-blue-100"},Ie={class:"text-white space-y-2"},Ae=s("p",{class:"text-xs text-[#BADFF7]"},"Servizi",-1),Be={class:"text-sm m-0 text-[#BADFF7] my-0"},Me={class:"flex justify-between my-0"},Ne={class:"flex justify-between my-0"},Ee={class:"flex justify-end gap-x-2"},Fe={key:0,class:"font-bold"},Le={class:"flex justify-between my-0"},Te={class:"flex justify-end gap-x-2"},$e={key:0,class:"font-bold"},Oe={class:"flex justify-between my-0"},Ue={class:"flex justify-end gap-x-2"},Ye={key:0,class:"font-bold"},He=s("div",{class:"h-[1px] bg-white my-4"},null,-1),Ke={key:0,class:"flex justify-between items-baseline"},qe=s("p",{class:"text-white text-md font-semibold"},[s("span",null,"Gi\xE0 pagato")],-1),Ge={class:"flex items-baseline space-x-4"},Re={class:"text-white text-md font-bold"},We={class:"flex justify-between items-baseline"},Je=s("p",{class:"text-white text-lg font-semibold"},[s("span",null,"Totale")],-1),Qe={class:"flex items-baseline space-x-4"},Xe={class:"text-white text-xl font-bold"},Ze={key:1,class:"flex justify-between items-baseline"},et=s("p",{class:"text-white text-md font-semibold"},[s("span",null,"Da rimborsare")],-1),tt={class:"flex items-baseline space-x-4"},st={class:"text-white text-md font-bold"},ot={class:"md:col-span-2 flex justify-start items-start my-4"},it=f("Ho letto e accetto i "),nt=s("a",{target:"_blank",href:"https://weareemma.ac-page.com/terms-and-conditions"},"termini e le condizioni del servizio",-1),lt={class:"flex justify-center mt-5"},at=f(" Conferma "),dt=f(" Acquista "),ct=f(" Salva modifiche "),rt=f(" Acquista modifiche "),ut={key:1,class:"p-8 grid place-items-center"},_t={key:2,class:"flex flex-col items-center"},bt={class:"max-w-xl mx-auto"},ft=s("p",{class:"font-bold mb-3"},"Hai un codice sconto?",-1),pt={class:"mb-6"},mt={key:0},vt={class:"flex space-x-4"},ht=f(" Verifica "),xt={key:0,class:"text-xs text-bb-danger mt-2"},gt={key:1},yt={class:"mb-2"},kt=f(" Codice sconto applicato: "),wt=f(" Effettua prenotazione "),Ct={key:2},St=f(" Modifica prenotazione "),It={__name:"StepCheckout",props:{noStripe:{type:Boolean,default:!1}},setup(z){const x=ue(),{isStylist:zt,loading:W,wizardSelection:r,wizardGeneral:t,people:j,ready:jt,totalReady:J}=ne(x),Q=le().props.value.primaries_not_included,X=E("updateData"),Z=E("reload"),ee=E("prev");E("next");const T=M(!1),C=R(()=>!J.value||T.value),F=M(!1);function A(){return F.value?!0:(u.flash({type:"error",message:"Devi accettare i termini e le condizioni del servizio"}),!1)}const te=M(t.value.stores.find(d=>d.id===r.value.store_id).name),se=M(t.value.stores.find(d=>d.id===r.value.store_id).address),v=R(()=>{let d=t.value.booking_infos.actual_net_price;return t.value.original_booking&&t.value.order&&d>t.value.order.paid&&(d=d-t.value.order.paid),d});function $(){Z()}function oe(){x.$reset()}function O(){const d=t.value.discount;t.value.discount=null,t.value.discount_errors=null,t.value.booking_infos.discount=null,t.value.booking_infos.actual_net_price+=d.discount_amount,X()}function U(d=!1){console.log("CHECKOUT NOSTRIPE ADMIN "+v.value),x.loading=!0,L({...t.value,...r.value,people:j.value}).transform(h=>({...h,notify:d})).post(route("booking.store"),{preserveScroll:!0,preserveState:!0,onSuccess:h=>{var k,p,D;let g=(D=(p=(k=h.props)==null?void 0:k.flash)==null?void 0:p.data)==null?void 0:D.booking;L({...g}).post(route("booking.success.nostripe"))},onError:()=>{x.loading=!1}})}function Y(d=!1,a=!1){console.log("EDIT BOOKING ADMIN"+v.value),x.loading=!0,t.value.with_refund=d,L({...t.value,...r.value,people:j.value}).transform(g=>({...g,notify:a})).put(route("booking.update",t.value.original_booking.id),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{oe(),u.flash({type:"success",message:"Appuntamento modificato"}),ae.Inertia.visit(route("home"))},onError:()=>{x.loading=!1}})}function B(d){r.value.selected_day&&r.value.selected_slot&&(T.value=!0,axios.post(route("booking.hair-services.check-availability"),{...t.value,...r.value,people:j.value,axios:!0}).then(a=>{u.lg(a);const{days:h}=a.data,g=h.find(S=>S.date===r.value.selected_day.date&&S.available);g&&g.slots.find(k=>k.time===r.value.selected_slot.time&&k.available)?d():H()}))}function H(){u.flash({type:"error",message:"Lo slot selezionato non \xE8 pi\xF9 disponibile!"}),ee()}return(d,a)=>{var D;const h=V("bb-input"),g=V("bb-link"),S=V("bb-checkbox"),k=V("bb-label"),p=V("bb-button");return o(),i("div",null,[b(ce,{isOpen:e(W)},null,8,["isOpen"]),!z.noStripe&&e(t).payment_infos?(o(),w(re,{key:0,"disable-edit":e(t).disable_edit,user:e(t).payment_infos.user,"additional-payload":{...e(t),...e(r),people:e(j)},intent:e(t).payment_infos.intent,"stripe-key":e(t).payment_infos.stripeKey,"total-amount":e(v)},{summary:m(({buy:P})=>{var K,q;return[e(v)>0&&e(t).booking_infos.actual_net_price>0&&e(t).original_booking===null?(o(),i(y,{key:0},[xe,s("div",ge,[e(t).discount?(o(),i("div",Se,[s("div",null,[ze,s("strong",null,n(e(t).discount.code),1)]),s("button",{onClick:O},[b(e(_e),{class:"w-5 h-5"})])])):(o(),i("div",ye,[b(h,{modelValue:e(t).discount_code,"onUpdate:modelValue":a[0]||(a[0]=l=>e(t).discount_code=l),class:I(["w-full bg-bb-blue-500 text-white",{"border-bb-danger":(K=e(t).discount_errors)==null?void 0:K.length}]),placeholder:"Inserisci il codice sconto"},null,8,["modelValue","class"]),(q=e(t).discount_errors)!=null&&q.length?(o(),i("div",ke," Codice sconto non valido ")):c("",!0),s("div",we,[b(g,{class:"text-white underline hover:text-bb-blue-100",onClick:$},{default:m(()=>[Ce]),_:1})])]))])],64)):c("",!0),s("div",je,[De,s("p",Pe,n(e(de)(e(r).selected_day.date).format("D MMM YYYY"))+" ore "+n(e(r).selected_slot.time),1),s("p",Ve,n(te.value)+" - "+n(se.value),1)]),s("div",Ie,[Ae,(o(!0),i(y,null,N(e(j),l=>{var G;return o(),i(y,null,[s("p",Be,n(l.name===0?"Tu":"Amica "+l.name),1),s("div",Me,[s("div",null,n(l.primary_service.title),1),s("div",{class:I(["font-bold",l.name===0&&e(t).subscribed&&!e(Q).includes((G=l.primary_service)==null?void 0:G.title)?"line-through":""])},n(e(u).printPrice(l.primary_service.net_price))+"\u20AC ",3)]),(o(!0),i(y,null,N(l.addons.updo,_=>(o(),i("div",Ne,[s("div",null,n(_.title),1),s("div",Ee,[s("div",{class:I(["font-bold",l.name===0&&e(t).subscribed?"line-through":""])},n(e(u).printPrice(_.net_price))+"\u20AC",3),l.name===0&&e(t).subscribed?(o(),i("div",Fe,n(e(u).printPrice(_.net_price_discounted))+"\u20AC",1)):c("",!0)])]))),256)),(o(!0),i(y,null,N(l.addons.massage,_=>(o(),i("div",Le,[s("div",null,n(_.title),1),s("div",Te,[s("div",{class:I(["font-bold",l.name===0&&e(t).subscribed?"line-through":""])},n(e(u).printPrice(_.net_price))+"\u20AC",3),l.name===0&&e(t).subscribed?(o(),i("div",$e,n(e(u).printPrice(_.net_price_discounted))+"\u20AC",1)):c("",!0)])]))),256)),(o(!0),i(y,null,N(l.addons.treatment,_=>(o(),i("div",Oe,[s("div",null,n(_.title),1),s("div",Ue,[s("div",{class:I(["font-bold",l.name===0&&e(t).subscribed?"line-through":""])},n(e(u).printPrice(_.net_price))+"\u20AC",3),l.name===0&&e(t).subscribed?(o(),i("div",Ye,n(e(u).printPrice(_.net_price_discounted))+"\u20AC",1)):c("",!0)])]))),256))],64)}),256))]),He,s("div",null,[e(t).order&&e(t).booking_infos.actual_net_price>=e(t).alreadyPaid?(o(),i("div",Ke,[qe,s("div",Ge,[s("div",Re,n(e(t).order.paid)+"\u20AC ",1)])])):c("",!0),s("div",We,[Je,s("div",Qe,[s("div",Xe,n(e(u).printPrice(e(v)))+"\u20AC ",1)])]),e(t).original_booking&&e(t).booking_infos.actual_net_price<e(t).alreadyPaid?(o(),i("div",Ze,[et,s("div",tt,[s("div",st,n(e(t).alreadyPaid)+"\u20AC ",1)])])):c("",!0)]),s("div",ot,[b(S,{modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=l=>F.value=l),class:"bg-bb-blue-500 checked:border-white"},null,8,["modelValue"]),b(k,{class:"mx-3 text-sm text-white"},{default:m(()=>[it,nt]),_:1})]),s("div",lt,[!e(t).original_booking&&e(v)===0?(o(),w(p,{key:0,disabled:e(C),light:"",onClick:a[2]||(a[2]=()=>{A()&&B(()=>{U()})})},{default:m(()=>[at]),_:1},8,["disabled"])):c("",!0),!e(t).original_booking&&e(v)>0?(o(),w(p,{key:1,disabled:e(C),light:"",onClick:()=>{A()&&B(()=>{P()})}},{default:m(()=>[dt]),_:2},1032,["disabled","onClick"])):e(t).original_booking?(o(),i(y,{key:2},[e(v)===e(t).alreadyPaid?(o(),w(p,{key:0,disabled:e(C),light:"",onClick:a[3]||(a[3]=()=>{A()&&B(()=>{Y()})})},{default:m(()=>[ct]),_:1},8,["disabled"])):(o(),w(p,{key:1,disabled:e(C),light:"",onClick:()=>{A()&&B(()=>{P()})}},{default:m(()=>[rt]),_:2},1032,["disabled","onClick"]))],64)):c("",!0)])]}),_:1},8,["disable-edit","user","additional-payload","intent","stripe-key","total-amount"])):c("",!0),!z.noStripe&&!e(t).payment_infos?(o(),i("div",ut,[b(e(he),{class:"w-12 h-12 animate-spin text-bb-primary"})])):c("",!0),z.noStripe?(o(),i("div",_t,[s("div",bt,[(e(v)>0||e(t).discount)&&e(t).original_booking===null?(o(),i(y,{key:0},[ft,s("div",pt,[e(t).discount?(o(),i("div",gt,[s("div",yt,[kt,s("strong",null,n(e(t).discount.code),1)]),s("div",{class:"text-center text-bb-danger cursor-pointer",onClick:O}," rimuovi codice sconto ")])):(o(),i("div",mt,[s("div",vt,[b(h,{modelValue:e(t).discount_code,"onUpdate:modelValue":a[4]||(a[4]=P=>e(t).discount_code=P),class:"w-auto",placeholder:"Inserisci codice sconto"},null,8,["modelValue"]),b(p,{success:"",onClick:$},{default:m(()=>[ht]),_:1})]),(D=e(t).discount_errors)!=null&&D.length?(o(),i("div",xt," Codice sconto non valido ")):c("",!0)]))])],64)):c("",!0),e(t).original_booking?(o(),i("div",Ct,[b(p,{disabled:e(C),class:"w-full",outline:"",onClick:Y},{default:m(()=>[St]),_:1},8,["disabled"])])):(o(),w(p,{key:1,class:"w-full",outline:"",onClick:a[5]||(a[5]=P=>U()),disabled:e(C)},{default:m(()=>[wt]),_:1},8,["disabled"]))])])):c("",!0)])}}};export{It as default};
