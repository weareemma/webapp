import{g as P,W,r as m,y as _e,o as s,c as n,b as r,w as u,q as h,I as v,a as e,K as i,U as l,a8 as p,e as he,L as d,J as M,Q as D,Y as f,S as _,X as C,a9 as X}from"./app.45a2e0de.js";import{_ as fe}from"./AppLayout.f8630d45.js";import ge from"./BookingStatusLight.3c62d82c.js";import ke from"./ScheduleAppointmentStatusBadge.d0c04c36.js";import{B as j}from"./Table.e80badd5.js";import ye from"./BookingPaymentDialog.c21dfd47.js";import{r as ve}from"./CheckCircleIcon.b6e74efe.js";import"./Logo.1cde1930.js";import"./wizardStore.ef397de9.js";import"./menu.365b37e7.js";import"./ChevronDownIcon.ec8df155.js";import"./CheckIcon.b71d4ea3.js";import"./XIcon.52e671f8.js";import"./PencilIcon.9b9a523e.js";import"./RefreshIcon.76168562.js";const pe={class:"flex justify-start items-center mt-4 mb-6"},xe={class:"bb-card p-8 mb-8"},we={class:"flex flex-wrap items-center justify-between gap-4 mb-4"},Se={class:"flex items-center space-x-4"},Pe={class:"text-bb-blue-500 big-header-title"},De={key:0,class:"flex items-center space-x-4"},Ce=_("Cancella"),je=_("Modifica"),Be={key:1},ze=_("Non presentato"),Ae={class:"bb-tab-bar"},Ve=["onClick"],Ye={key:0},Ne={class:"space-y-3 mb-8"},Me=e("h2",{class:"text-xl font-medium text-bb-primary"},"Informazioni",-1),Te={class:"flex items-center"},Ie=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs pt-[5px]"}," Cliente ",-1),$e={class:"flex-1 flex items-center space-x-2"},He=["src"],Ee={class:"underline"},Fe=["href"],Ue={class:"text-bb-primary font-bold"},Oe={class:"flex items-center"},qe=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs pt-[5px]"}," Orario ",-1),Re={class:"flex-1"},Le={class:"flex items-center"},Ge=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs pt-[5px]"}," Stylist ",-1),Je={class:"flex-1"},Ke={class:"flex items-center"},Qe=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Status",-1),We={class:"flex-1"},Xe={class:"flex items-center"},Ze=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Store",-1),et={class:"flex-1"},tt={class:"flex items-center"},ot=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Abbonamento",-1),st={key:0},nt={key:1},it={class:"flex items-center"},at=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Sconto",-1),lt={key:0},ct={key:1},rt={class:"flex items-center"},dt=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Pacchetti",-1),ut={key:0},bt={key:1},mt={class:"flex items-center"},_t=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Creato il",-1),ht={class:"flex-1"},ft={class:"flex items-center"},gt=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Durata",-1),kt={class:"flex-1"},yt={class:"space-y-3 mb-8"},vt=e("h2",{class:"text-xl font-medium text-bb-primary"},"Servizi prenotati",-1),pt={key:0,class:"flex justify-between gap-x-1"},xt={key:0},wt={key:1,class:"flex justify-between gap-x-1"},St={key:0},Pt={key:1,class:"flex justify-between gap-x-1"},Dt={key:0,class:"flex justify-center"},Ct={key:0,class:"flex justify-end space-x-12"},jt={class:"flex items-center space-x-3"},Bt=e("div",{class:"uppercase"},"totale",-1),zt={key:0,class:"line-through text-bb-gray-500"},At={class:"font-bold text-bb-blue-600"},Vt={class:"flex items-center space-x-3"},Yt=e("div",{class:"uppercase"},"pagato",-1),Nt={key:1,class:"text-right underline"},Mt=["href"],Tt={key:2,class:"space-y-3 mb-8"},It=e("h2",{class:"text-xl font-medium text-bb-primary"},"Transazioni",-1),$t={key:0,class:"bb-badge-warning inline-block"},Ht={key:3,class:"space-y-3 mb-8"},Et=e("h2",{class:"text-xl font-medium text-bb-primary"},"Rimborsi",-1),Ft={key:1},Ut={class:"flex items-center justify-between"},Ot=e("h2",{class:"text-xl font-medium text-bb-primary"}," Pagamenti in store ",-1),qt=_("Aggiungi"),Rt={key:2},Lt={class:"p-4 flex justify-start gap-x-4 items-center"},Gt=e("p",null,"Ipratico id corrente:",-1),Jt={class:"font-bold"},Kt={class:"font-bold"},Qt={key:3},Wt=_(" Elimina appuntamento "),Xt=e("p",null,"Una volta eliminato, non potrai pi\xF9 recuperare le informazioni.",-1),Zt=e("br",null,null,-1),eo=e("p",null,"Scegli una modalit\xE0 di cancellazione",-1),to=_(" Elimina "),oo=_(" Elimina pagamento "),so=e("span",null,"Una volta eliminato, non potrai pi\xF9 recuperare le informazioni.",-1),no=_(" Elimina "),po={__name:"Show",props:{booking:Object,payments:Array,storePayments:Array,refunds:Array,history:Array},setup(t){const b=t;P(()=>W().props.value.is_admin);const T=W().props.value.primaries_not_included,B=m(null),I=m([]);_e(()=>{B.value=b.booking.stylist_id,Z(),console.log(b.booking)});function Z(){axios.get(route("booking.stylists",b.booking.id)).then(a=>{I.value=a.data})}function ee(a){C.Inertia.post(route("booking.update.stylist",b.booking.id),{stylist_id:a},{onSuccess:c=>{f.flash(c.props.flash)}})}const g=m("info"),te=[{key:"info",title:"Info",visible:!0},{key:"store-payments",title:"Pagamenti in store",visible:b.booking.is_father},{key:"history",title:"Storico",visible:b.booking.is_father}],k=P(()=>{var a;return(a=b.booking.additional_data)==null?void 0:a.subscription}),$=P(()=>{var a,c;return(c=(a=b.booking.additional_data)==null?void 0:a.packages)!=null?c:[]}),H=P(()=>{var a;return(a=b.booking.additional_data)==null?void 0:a.discount}),z=m(null),x=m(!1),w=m(null);function oe(){x.value=!0}function se(){x.value=!1}function ne({action:a,item:c}){switch(a){case"delete":w.value=X(c),z.value.open();break}}function ie(){w.value.delete(route("payment.destroy",w.value.id),{onSuccess:()=>{z.value.close()}})}const E=m(null),A=m(null),V=m(!1),Y=m("refund");function ae(){E.value=X(b.booking),A.value.open()}function le(){V.value=!0,C.Inertia.delete(route("booking.destroy",E.value.id),{data:{method:Y.value,redirect_to:"schedule.appointment.index"},onFinish:()=>{f.flash({type:"success",message:"Appuntamento cancellato"}),A.value.close(),emit("deleted"),V.value=!1}})}function ce(){C.Inertia.post(route("booking.notShown",b.booking.id),{onFinish:()=>{f.flash({type:"success",message:"Stato aggiornato"})}})}function re({action:a,item:c}){switch(a){case"download":window.open(route("payment.invoice",[c.user_id,c.id]),"_blank");break}}function de(a){var c;C.Inertia.visit(route(a,(c=b.booking.parent_id)!=null?c:b.booking.id))}return(a,c)=>{const ue=v("bb-back-link"),S=v("bb-button"),be=v("BbSelect"),me=v("bb-radio-group"),F=v("BbButton"),U=v("BbDialog");return s(),n(h,null,[r(fe,{title:"Booking show","show-title":!1},{default:u(()=>{var y,O,q,R,L,G,J;return[e("div",pe,[r(ue,{url:a.route("schedule.appointment.past")},null,8,["url"])]),e("div",xe,[e("div",we,[e("div",Se,[e("h1",Pe," Appuntamento di "+i((y=t.booking.customer)==null?void 0:y.name)+" del "+i(l(p)(t.booking.date).format("DD/MM/YYYY")),1),r(ge,{status:t.booking.status},null,8,["status"])]),!t.booking.is_past&&t.booking.status!=="cancelled"?(s(),n("div",De,[t.booking.is_father?(s(),he(S,{key:0,light:"",onClick:ae},{default:u(()=>[Ce]),_:1})):d("",!0),r(S,{onClick:c[0]||(c[0]=o=>de("booking.edit"))},{default:u(()=>[je]),_:1})])):d("",!0),t.booking.is_past&&t.booking.status!=="not_shown"?(s(),n("div",Be,[r(S,{light:"",onClick:ce},{default:u(()=>[ze]),_:1})])):d("",!0)]),e("div",Ae,[(s(),n(h,null,M(te,o=>(s(),n(h,null,[o.visible?(s(),n("button",{key:o.key,class:D(["bb-tab-bar__button",{"bb-tab-bar__button--active":o.key==g.value}]),onClick:K=>g.value=o.key},i(o.title),11,Ve)):d("",!0)],64))),64))]),g.value=="info"?(s(),n("div",Ye,[e("div",Ne,[Me,e("div",Te,[Ie,e("div",$e,[e("img",{src:(O=t.booking.customer)==null?void 0:O.profile_photo_url,class:"block rounded-full w-8 h-8 object-cover object-center"},null,8,He),e("div",Ee,[e("a",{href:a.route("customer.show",t.booking.customer)},i((q=t.booking.customer)==null?void 0:q.full_name),9,Fe)]),e("div",Ue,i(t.booking.is_father?"":"Amica "+t.booking.guest),1)])]),e("div",Oe,[qe,e("div",Re,i(l(p)(`2000-01-01 ${t.booking.start}`).format("HH:mm"))+" - "+i(l(p)(`2000-01-01 ${t.booking.start}`).add(t.booking.total_execution_time,"minutes").format("HH:mm")),1)]),e("div",Le,[Ge,e("div",Je,[r(be,{mode:"single",placeholder:"Seleziona lo stylist","close-on-select":!0,options:I.value,modelValue:B.value,"onUpdate:modelValue":c[1]||(c[1]=o=>B.value=o),onChange:ee,disabled:t.booking.is_past||t.booking.status==="cancelled"},null,8,["options","modelValue","disabled"])])]),e("div",Ke,[Qe,e("div",We,[r(ke,{status:t.booking.status,label:t.booking.status_formatted},null,8,["status","label"])])]),e("div",Xe,[Ze,e("div",et,[e("span",null,i((L=(R=t.booking.store)==null?void 0:R.name)!=null?L:"-"),1)])]),t.booking.is_father?(s(),n(h,{key:0},[e("div",tt,[ot,l(k)?(s(),n("span",st,i(l(k).name),1)):(s(),n("span",nt,"Nessuno"))]),e("div",it,[at,l(H)?(s(),n("span",lt,i(l(H).code),1)):(s(),n("span",ct,"Nessuno"))]),e("div",rt,[dt,(G=l($))!=null&&G.length?(s(),n("span",ut,i(l($).map(o=>`Pacchetto ${o.name}`).join(", ")),1)):(s(),n("span",bt,"Nessuno"))]),e("div",mt,[_t,e("div",ht,i(l(p)(t.booking.order?t.booking.order.created_at:t.booking.created_at).format("DD/MM/YYYY HH:mm")),1)])],64)):d("",!0),e("div",ft,[gt,e("div",kt,i(t.booking.duration),1)])]),e("div",yt,[vt,r(j,{collection:t.booking.slots,columns:[{key:"service.title",label:"Servizio",classes:"font-bold"},{slot:"price",label:"Prezzo"},{slot:"extra",label:"Extra"},{computed:()=>null,label:"",classes:"w-full"}]},{price:u(({item:o})=>[o.service.extra?(s(),n("div",Pt,[e("span",null,i(l(f).printPrice(o.service.net_price))+" \u20AC",1)])):(s(),n(h,{key:0},[o.service.level==="primary"?(s(),n("div",pt,[e("span",{class:D(l(k)&&t.booking.is_father&&!l(T).includes(o.service.title)?"line-through":"")},i(l(f).printPrice(o.service.net_price))+" \u20AC",3),l(k)&&t.booking.is_father&&!l(T).includes(o.service.title)?(s(),n("span",xt,"0 \u20AC")):d("",!0)])):d("",!0),o.service.level!=="primary"?(s(),n("div",wt,[e("span",{class:D(l(k)&&t.booking.is_father&&o.service.net_price_discounted?"line-through":"")},i(l(f).printPrice(o.service.net_price))+" \u20AC",3),l(k)&&t.booking.is_father&&o.service.net_price_discounted?(s(),n("span",St,i(l(f).printPrice(o.service.net_price_discounted))+" \u20AC",1)):d("",!0)])):d("",!0)],64))]),extra:u(({item:o})=>[o.service.extra?(s(),n("div",Dt,[r(l(ve),{class:"w-5 h-5 text-green-500"})])):d("",!0)]),_:1},8,["collection","columns"])]),t.booking.is_father?(s(),n("div",Ct,[e("div",jt,[Bt,t.booking.total_net_price_original>t.booking.total_net_price?(s(),n("div",zt,i(t.booking.total_net_price_original)+"\u20AC ",1)):d("",!0),e("div",At,i(t.booking.total_net_price)+" \u20AC ",1)]),e("div",Vt,[Yt,e("div",{class:D(["font-bold",{"text-bb-blue-600":t.booking.amount_to_pay<=0,"text-bb-danger":t.booking.amount_to_pay>0}])},i(t.booking.paid_amount)+" \u20AC ",3)])])):(s(),n("div",Nt,[e("a",{href:a.route("booking.show",t.booking.parent_id)}," Vedi prenotazione principale > ",8,Mt)])),t.booking.is_father?(s(),n("div",Tt,[It,r(j,{collection:t.payments,columns:[{key:"date",label:"Data"},{computed:o=>{switch(o.subject){case"booking-create":return"Nuovo appuntamento";case"booking-edit":return"Modifica appuntamento";case"package":return"Acquisto pacchetto";case"subscription":return"Acquisto abbonamento"}},label:"Oggetto"},{computed:o=>{switch(o.method){case"stripe":return"Stripe";case"cash":return"Pagamento in contanti";case"satispay":return"Pagamento con Satispay";case"card":return"Pagamento in carta"}},label:"Metodo di pagamento"},{key:"total",label:"Totale",format:"currency"},{slot:"refunded",label:""}],actions:["download"],onAction:re},{refunded:u(({item:o})=>[o.refunded?(s(),n("div",$t,"Rimborsato")):d("",!0)]),_:1},8,["collection","columns"])])):d("",!0),t.booking.is_father?(s(),n("div",Ht,[Et,r(j,{collection:t.refunds,columns:[{key:"created_at",label:"Data",format:"datetime"},{key:"total",label:"Totale",format:"currency"}]},null,8,["collection"])])):d("",!0)])):d("",!0),g.value=="store-payments"?(s(),n("div",Ft,[e("div",Ut,[Ot,r(S,{onClick:oe},{default:u(()=>[qt]),_:1})]),r(j,{collection:t.storePayments,columns:[{key:"date",label:"Data",format:"date:Y-m-d"},{computed:o=>{switch(o.method){case"stripe":return"Stripe";case"cash":return"Pagamento in contanti";case"satispay":return"Pagamento con Satispay";case"card":return"Pagamento in carta"}},label:"Metodo di pagamento"},{key:"total",label:"Totale",format:"currency"}],actions:["delete"],onAction:ne},null,8,["collection","columns"])])):d("",!0),g.value==="history"?(s(),n("div",Rt,[e("div",Lt,[Gt,e("p",Jt,i((J=t.history.current_ipratico_id)!=null?J:"-"),1)]),(s(!0),n(h,null,M(t.history.logs,(o,K)=>(s(),n("div",{key:K,class:"p-4 mb-4 max-w-md"},[e("h3",Kt,i(o.event)+" il "+i(l(p)(o.date).format("D/M/YYYY HH:mm")),1),(s(!0),n(h,null,M(o.diff,(N,Q)=>(s(),n("div",{key:Q,class:"flex justify-between items-center"},[e("p",null,i(Q),1),e("p",null,i(N!=null?N:"-"),1)]))),128))]))),128))])):d("",!0),g.value=="form"?(s(),n("div",Qt,"TODO")):d("",!0)])]}),_:1}),r(U,{ref_key:"deleteDialog",ref:A,type:"plain",size:"sm"},{title:u(()=>[Wt]),buttons:u(()=>[r(F,{danger:"",disabled:V.value,onClick:le},{default:u(()=>[to]),_:1},8,["disabled"])]),default:u(()=>[Xt,Zt,eo,r(me,{class:"py-2",modelValue:Y.value,"onUpdate:modelValue":c[2]||(c[2]=y=>Y.value=y),vertical:!0,options:[{value:"refund",label:"Rimborso"},{value:"discount",label:"Genera sconto"},{value:"none",label:"Nessuna azione"}]},null,8,["modelValue"])]),_:1},512),r(U,{ref_key:"storePaymentDeleteDialog",ref:z,type:"plain",size:"sm"},{title:u(()=>[oo]),buttons:u(()=>[r(F,{danger:"",disabled:w.value.processing,onClick:ie},{default:u(()=>[no]),_:1},8,["disabled"])]),default:u(()=>[so]),_:1},512),r(ye,{"booking-id":t.booking.id,modelValue:x.value,"onUpdate:modelValue":c[3]||(c[3]=y=>x.value=y),amount:t.booking.amount_to_pay>0?t.booking.amount_to_pay:0,onClose:se},null,8,["booking-id","modelValue","amount"])],64)}}};export{po as default};
