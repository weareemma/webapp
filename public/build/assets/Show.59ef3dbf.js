import{g as P,W as ne,r as m,y as we,al as I,o as s,c as n,b as l,w as u,q as g,I as f,a as e,K as a,U as d,a8 as x,e as Se,L as r,J as $,Q as D,Y as h,S as _,X as C,a9 as ie}from"./app.c248d67c.js";import{_ as Pe}from"./AppLayout.4269b78a.js";import De from"./BookingStatusLight.49d3de70.js";import Ce from"./ScheduleAppointmentStatusBadge.3b648ebd.js";import{B as N}from"./Table.94a0e2ae.js";import Ne from"./BookingPaymentDialog.53cd0b2c.js";import{r as Ve}from"./CheckCircleIcon.e349a6b1.js";import"./Logo.d971df1b.js";import"./wizardStore.2226bc2a.js";import"./menu.6da08311.js";import"./ChevronDownIcon.f3847a45.js";import"./CheckIcon.5f685430.js";import"./XIcon.0ce515ba.js";import"./PencilIcon.50f1eb3f.js";import"./RefreshIcon.6547917e.js";const Be={class:"flex justify-start items-center mt-4 mb-6"},je={class:"bb-card p-8 mb-8"},ze={class:"flex flex-wrap items-center justify-between gap-4 mb-4"},Ae={class:"flex items-center space-x-4"},Ye={class:"text-bb-blue-500 big-header-title"},Te={key:0,class:"flex items-center space-x-4"},Me=_("Cancella"),Ie=_("Modifica"),$e={key:1},He=_("Non presentato"),Ue={class:"bb-tab-bar"},Ee=["onClick"],Fe={key:0},Oe={class:"space-y-4 mb-8"},qe=e("h2",{class:"text-xl font-medium text-bb-primary"},"Informazioni",-1),Re={class:"flex items-center"},Le=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs pt-[5px]"}," Cliente ",-1),Ge={class:"flex-1 flex items-center space-x-2"},Je=["src"],Ke={class:"underline"},Qe=["href"],We={class:"text-bb-primary font-bold"},Xe={class:"flex items-center"},Ze=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs pt-[5px]"}," Orario ",-1),et={class:"flex-1"},tt={class:"flex items-center"},ot=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs pt-[5px]"}," Stylist ",-1),st={class:"flex-1"},nt={class:"flex items-center"},it=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Status",-1),at={class:"flex-1"},lt={class:"flex items-center"},ct=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Store",-1),dt={class:"flex-1"},rt={class:"flex items-center"},ut=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Abbonamento",-1),bt={key:0},mt={key:1},_t={class:"flex items-center"},ht=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Sconto",-1),gt={key:0},ft={key:1},vt={class:"flex items-center"},kt=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Pacchetti",-1),pt={key:0},yt={key:1},xt={class:"flex items-center"},wt=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Creato il",-1),St={class:"flex-1"},Pt={class:"flex items-center"},Dt=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Durata",-1),Ct={class:"flex-1"},Nt={key:1,class:"flex items-start"},Vt=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Note cliente",-1),Bt={class:"flex-1"},jt=_(" Salva "),zt={class:"flex items-start"},At=e("div",{class:"uppercase text-bb-gray-700 w-36 text-xs"},"Note appuntamento",-1),Yt={class:"flex-1"},Tt=_(" Salva "),Mt={class:"space-y-3 mb-8"},It=e("h2",{class:"text-xl font-medium text-bb-primary"},"Servizi prenotati",-1),$t={key:0,class:"flex justify-between gap-x-1"},Ht={key:0},Ut={key:1,class:"flex justify-between gap-x-1"},Et={key:0},Ft={key:1,class:"flex justify-between gap-x-1"},Ot={key:0,class:"flex justify-center"},qt={key:0,class:"flex justify-end space-x-12"},Rt={class:"flex items-center space-x-3"},Lt=e("div",{class:"uppercase"},"totale",-1),Gt={key:0,class:"line-through text-bb-gray-500"},Jt={class:"font-bold text-bb-blue-600"},Kt={class:"flex items-center space-x-3"},Qt=e("div",{class:"uppercase"},"pagato",-1),Wt={key:1,class:"text-right underline"},Xt=["href"],Zt={key:2,class:"space-y-3 mb-8"},eo=e("h2",{class:"text-xl font-medium text-bb-primary"},"Transazioni",-1),to={key:0,class:"bb-badge-warning inline-block"},oo={key:3,class:"space-y-3 mb-8"},so=e("h2",{class:"text-xl font-medium text-bb-primary"},"Rimborsi",-1),no={key:1},io={class:"flex items-center justify-between"},ao=e("h2",{class:"text-xl font-medium text-bb-primary"}," Pagamenti in store ",-1),lo=_("Aggiungi"),co={key:2},ro={class:"p-4 flex justify-start gap-x-4 items-center"},uo=e("p",null,"Ipratico id corrente:",-1),bo={class:"font-bold"},mo={class:"font-bold"},_o={key:3},ho=_(" Elimina appuntamento "),go=e("p",null,"Una volta eliminato, non potrai pi\xF9 recuperare le informazioni.",-1),fo=e("br",null,null,-1),vo=e("p",null,"Scegli una modalit\xE0 di cancellazione",-1),ko=_(" Elimina "),po=_(" Elimina pagamento "),yo=e("span",null,"Una volta eliminato, non potrai pi\xF9 recuperare le informazioni.",-1),xo=_(" Elimina "),$o={__name:"Show",props:{booking:Object,payments:Array,storePayments:Array,refunds:Array,history:Array},setup(t){var q,R,L;const b=t;P(()=>ne().props.value.is_admin);const H=ne().props.value.primaries_not_included,V=m(null),U=m([]);we(()=>{V.value=b.booking.stylist_id,ae()});function ae(){I.get(route("booking.stylists",b.booking.id)).then(c=>{U.value=c.data})}function le(c){C.Inertia.post(route("booking.update.stylist",b.booking.id),{stylist_id:c},{onSuccess:i=>{h.flash(i.props.flash)}})}const v=m("info"),ce=[{key:"info",title:"Info",visible:!0},{key:"store-payments",title:"Pagamenti in store",visible:b.booking.is_father},{key:"history",title:"Storico",visible:b.booking.is_father}],k=P(()=>{var c;return(c=b.booking.additional_data)==null?void 0:c.subscription}),E=P(()=>{var c,i;return(i=(c=b.booking.additional_data)==null?void 0:c.packages)!=null?i:[]}),F=P(()=>{var c;return(c=b.booking.additional_data)==null?void 0:c.discount}),B=m(null),w=m(!1),S=m(null);function de(){w.value=!0}function re(){w.value=!1}function ue({action:c,item:i}){switch(c){case"delete":S.value=ie(i),B.value.open();break}}function be(){S.value.delete(route("payment.destroy",S.value.id),{onSuccess:()=>{B.value.close()}})}const O=m(null),j=m(null),z=m(!1),A=m("refund");function me(){O.value=ie(b.booking),j.value.open()}function _e(){z.value=!0,C.Inertia.delete(route("booking.destroy",O.value.id),{data:{method:A.value,redirect_to:"schedule.appointment.index"},onFinish:()=>{h.flash({type:"success",message:"Appuntamento cancellato"}),j.value.close(),emit("deleted"),z.value=!1}})}function he(){C.Inertia.post(route("booking.notShown",b.booking.id),{onFinish:()=>{h.flash({type:"success",message:"Stato aggiornato"})}})}function ge({action:c,item:i}){switch(c){case"download":window.open(route("payment.invoice",[i.user_id,i.id]),"_blank");break}}function fe(c){var i;C.Inertia.visit(route(c,(i=b.booking.parent_id)!=null?i:b.booking.id))}const Y=m((R=(q=b.booking.customer)==null?void 0:q.last_notes)!=null?R:""),T=m((L=b.booking.stylist_notes)!=null?L:""),ve=()=>{I.post(route("notes.customer",b.booking.customer.id),{notes:Y.value}).then(()=>{h.flash({type:"success",message:"Note salvate"})})},ke=()=>{I.post(route("notes.booking",b.booking.id),{notes:T.value}).then(()=>{h.flash({type:"success",message:"Note salvate"})})};return(c,i)=>{const pe=f("bb-back-link"),p=f("bb-button"),ye=f("BbSelect"),G=f("BbTextarea"),xe=f("bb-radio-group"),J=f("BbButton"),K=f("BbDialog");return s(),n(g,null,[l(Pe,{title:"Booking show","show-title":!1},{default:u(()=>{var y,Q,W,X,Z,ee,te;return[e("div",Be,[l(pe,{url:c.route("schedule.appointment.past")},null,8,["url"])]),e("div",je,[e("div",ze,[e("div",Ae,[e("h1",Ye," Appuntamento di "+a((y=t.booking.customer)==null?void 0:y.name)+" del "+a(d(x)(t.booking.date).format("DD/MM/YYYY")),1),l(De,{status:t.booking.status},null,8,["status"])]),!t.booking.is_past&&t.booking.status!=="cancelled"?(s(),n("div",Te,[t.booking.is_father?(s(),Se(p,{key:0,light:"",onClick:me},{default:u(()=>[Me]),_:1})):r("",!0),l(p,{onClick:i[0]||(i[0]=o=>fe("booking.edit"))},{default:u(()=>[Ie]),_:1})])):r("",!0),t.booking.is_past&&t.booking.status!=="not_shown"?(s(),n("div",$e,[l(p,{light:"",onClick:he},{default:u(()=>[He]),_:1})])):r("",!0)]),e("div",Ue,[(s(),n(g,null,$(ce,o=>(s(),n(g,null,[o.visible?(s(),n("button",{key:o.key,class:D(["bb-tab-bar__button",{"bb-tab-bar__button--active":o.key==v.value}]),onClick:oe=>v.value=o.key},a(o.title),11,Ee)):r("",!0)],64))),64))]),v.value=="info"?(s(),n("div",Fe,[e("div",Oe,[qe,e("div",Re,[Le,e("div",Ge,[e("img",{src:(Q=t.booking.customer)==null?void 0:Q.profile_photo_url,class:"block rounded-full w-8 h-8 object-cover object-center"},null,8,Je),e("div",Ke,[e("a",{href:c.route("customer.show",t.booking.customer)},a((W=t.booking.customer)==null?void 0:W.full_name),9,Qe)]),e("div",We,a(t.booking.is_father?"":"Amica "+t.booking.guest),1)])]),e("div",Xe,[Ze,e("div",et,a(d(x)(`2000-01-01 ${t.booking.start}`).format("HH:mm"))+" - "+a(d(x)(`2000-01-01 ${t.booking.start}`).add(t.booking.total_execution_time,"minutes").format("HH:mm")),1)]),e("div",tt,[ot,e("div",st,[l(ye,{mode:"single",placeholder:"Seleziona lo stylist","close-on-select":!0,options:U.value,modelValue:V.value,"onUpdate:modelValue":i[1]||(i[1]=o=>V.value=o),onChange:le,disabled:t.booking.is_past||t.booking.status==="cancelled"},null,8,["options","modelValue","disabled"])])]),e("div",nt,[it,e("div",at,[l(Ce,{status:t.booking.status,label:t.booking.status_formatted},null,8,["status","label"])])]),e("div",lt,[ct,e("div",dt,[e("span",null,a((Z=(X=t.booking.store)==null?void 0:X.name)!=null?Z:"-"),1)])]),t.booking.is_father?(s(),n(g,{key:0},[e("div",rt,[ut,d(k)?(s(),n("span",bt,a(d(k).name),1)):(s(),n("span",mt,"Nessuno"))]),e("div",_t,[ht,d(F)?(s(),n("span",gt,a(d(F).code),1)):(s(),n("span",ft,"Nessuno"))]),e("div",vt,[kt,(ee=d(E))!=null&&ee.length?(s(),n("span",pt,a(d(E).map(o=>`Pacchetto ${o.name}`).join(", ")),1)):(s(),n("span",yt,"Nessuno"))]),e("div",xt,[wt,e("div",St,a(d(x)(t.booking.order?t.booking.order.created_at:t.booking.created_at).format("DD/MM/YYYY HH:mm")),1)])],64)):r("",!0),e("div",Pt,[Dt,e("div",Ct,a(t.booking.duration),1)]),t.booking.is_father?(s(),n("div",Nt,[Vt,e("div",Bt,[l(G,{modelValue:Y.value,"onUpdate:modelValue":i[2]||(i[2]=o=>Y.value=o),class:"text-sm"},null,8,["modelValue"])]),l(p,{primary:"",class:"py-1 px-2 ml-2 text-xs",onClick:ve},{default:u(()=>[jt]),_:1})])):r("",!0),e("div",zt,[At,e("div",Yt,[l(G,{modelValue:T.value,"onUpdate:modelValue":i[3]||(i[3]=o=>T.value=o),class:"text-sm"},null,8,["modelValue"])]),l(p,{primary:"",class:"py-1 px-2 ml-2 text-xs",onClick:ke},{default:u(()=>[Tt]),_:1})])]),e("div",Mt,[It,l(N,{collection:t.booking.slots,columns:[{key:"service.title",label:"Servizio",classes:"font-bold"},{slot:"price",label:"Prezzo"},{slot:"extra",label:"Extra"},{computed:()=>null,label:"",classes:"w-full"}]},{price:u(({item:o})=>[o.service.extra?(s(),n("div",Ft,[e("span",null,a(d(h).printPrice(o.service.net_price))+" \u20AC",1)])):(s(),n(g,{key:0},[o.service.level==="primary"?(s(),n("div",$t,[e("span",{class:D(d(k)&&t.booking.is_father&&!d(H).includes(o.service.title)?"line-through":"")},a(d(h).printPrice(o.service.net_price))+" \u20AC",3),d(k)&&t.booking.is_father&&!d(H).includes(o.service.title)?(s(),n("span",Ht,"0 \u20AC")):r("",!0)])):r("",!0),o.service.level!=="primary"?(s(),n("div",Ut,[e("span",{class:D(d(k)&&t.booking.is_father&&o.service.net_price_discounted?"line-through":"")},a(d(h).printPrice(o.service.net_price))+" \u20AC",3),d(k)&&t.booking.is_father&&o.service.net_price_discounted?(s(),n("span",Et,a(d(h).printPrice(o.service.net_price_discounted))+" \u20AC",1)):r("",!0)])):r("",!0)],64))]),extra:u(({item:o})=>[o.service.extra?(s(),n("div",Ot,[l(d(Ve),{class:"w-5 h-5 text-green-500"})])):r("",!0)]),_:1},8,["collection","columns"])]),t.booking.is_father?(s(),n("div",qt,[e("div",Rt,[Lt,t.booking.total_net_price_original>t.booking.total_net_price?(s(),n("div",Gt,a(t.booking.total_net_price_original)+"\u20AC ",1)):r("",!0),e("div",Jt,a(t.booking.total_net_price)+" \u20AC ",1)]),e("div",Kt,[Qt,e("div",{class:D(["font-bold",{"text-bb-blue-600":t.booking.amount_to_pay<=0,"text-bb-danger":t.booking.amount_to_pay>0}])},a(t.booking.paid_amount)+" \u20AC ",3)])])):(s(),n("div",Wt,[e("a",{href:c.route("booking.show",t.booking.parent_id)}," Vedi prenotazione principale > ",8,Xt)])),t.booking.is_father?(s(),n("div",Zt,[eo,l(N,{collection:t.payments,columns:[{key:"date",label:"Data"},{computed:o=>{switch(o.subject){case"booking-create":return"Nuovo appuntamento";case"booking-edit":return"Modifica appuntamento";case"package":return"Acquisto pacchetto";case"subscription":return"Acquisto abbonamento"}},label:"Oggetto"},{computed:o=>{switch(o.method){case"stripe":return"Stripe";case"cash":return"Pagamento in contanti";case"satispay":return"Pagamento con Satispay";case"card":return"Pagamento in carta"}},label:"Metodo di pagamento"},{key:"total",label:"Totale",format:"currency"},{slot:"refunded",label:""}],actions:["download"],onAction:ge},{refunded:u(({item:o})=>[o.refunded?(s(),n("div",to,"Rimborsato")):r("",!0)]),_:1},8,["collection","columns"])])):r("",!0),t.booking.is_father?(s(),n("div",oo,[so,l(N,{collection:t.refunds,columns:[{key:"created_at",label:"Data",format:"datetime"},{key:"total",label:"Totale",format:"currency"}]},null,8,["collection"])])):r("",!0)])):r("",!0),v.value=="store-payments"?(s(),n("div",no,[e("div",io,[ao,l(p,{onClick:de},{default:u(()=>[lo]),_:1})]),l(N,{collection:t.storePayments,columns:[{key:"date",label:"Data",format:"date:Y-m-d"},{computed:o=>{switch(o.method){case"stripe":return"Stripe";case"cash":return"Pagamento in contanti";case"satispay":return"Pagamento con Satispay";case"card":return"Pagamento in carta"}},label:"Metodo di pagamento"},{key:"total",label:"Totale",format:"currency"}],actions:["delete"],onAction:ue},null,8,["collection","columns"])])):r("",!0),v.value==="history"?(s(),n("div",co,[e("div",ro,[uo,e("p",bo,a((te=t.history.current_ipratico_id)!=null?te:"-"),1)]),(s(!0),n(g,null,$(t.history.logs,(o,oe)=>(s(),n("div",{key:oe,class:"p-4 mb-4 max-w-md"},[e("h3",mo,a(o.event)+" il "+a(d(x)(o.date).format("D/M/YYYY HH:mm")),1),(s(!0),n(g,null,$(o.diff,(M,se)=>(s(),n("div",{key:se,class:"flex justify-between items-center"},[e("p",null,a(se),1),e("p",null,a(M!=null?M:"-"),1)]))),128))]))),128))])):r("",!0),v.value=="form"?(s(),n("div",_o,"TODO")):r("",!0)])]}),_:1}),l(K,{ref_key:"deleteDialog",ref:j,type:"plain",size:"sm"},{title:u(()=>[ho]),buttons:u(()=>[l(J,{danger:"",disabled:z.value,onClick:_e},{default:u(()=>[ko]),_:1},8,["disabled"])]),default:u(()=>[go,fo,vo,l(xe,{class:"py-2",modelValue:A.value,"onUpdate:modelValue":i[4]||(i[4]=y=>A.value=y),vertical:!0,options:[{value:"refund",label:"Rimborso"},{value:"discount",label:"Genera sconto"},{value:"none",label:"Nessuna azione"}]},null,8,["modelValue"])]),_:1},512),l(K,{ref_key:"storePaymentDeleteDialog",ref:B,type:"plain",size:"sm"},{title:u(()=>[po]),buttons:u(()=>[l(J,{danger:"",disabled:S.value.processing,onClick:be},{default:u(()=>[xo]),_:1},8,["disabled"])]),default:u(()=>[yo]),_:1},512),l(Ne,{"booking-id":t.booking.id,modelValue:w.value,"onUpdate:modelValue":i[5]||(i[5]=y=>w.value=y),amount:t.booking.amount_to_pay>0?t.booking.amount_to_pay:0,onClose:re},null,8,["booking-id","modelValue","amount"])],64)}}};export{$o as default};
