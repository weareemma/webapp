import{r as l,X as D,W as y,I as h,o,c as a,a as t,b as s,U as b,w as e,ag as V,S as c,y as I,e as w,K as n,L as S,q as j,a8 as M}from"./app.c248d67c.js";import{_ as E}from"./CustomerLayout.eb07e70f.js";import{r as O}from"./PencilIcon.722a49e8.js";import"./Logo.d971df1b.js";import"./Footer.0f48e628.js";import"./XIcon.0ce515ba.js";import"./PencilIcon.50f1eb3f.js";import"./disclosure.e9de6139.js";import"./menu.6da08311.js";const z=t("p",{class:"text-bb-blue-500"},"Modifica i dati della carta per il pagamento",-1),U={class:"grid grid-cols-2 gap-4"},A=c("Nome intestatario"),T=c("Numero Carta"),q=t("div",{id:"stripe-card-number"},null,-1),K=c("Data di scadenza"),F=t("div",{id:"stripe-card-expiry"},null,-1),L=c("CVV"),R=t("div",{id:"stripe-card-cvc"},null,-1),W=c(" Salva "),X={__name:"UpdatePaymentMethodModal",props:{intent:Object,opened:Boolean},setup(i){const _=l(null),g=window.Stripe(D.Inertia.page.props.stripeKey),x=g.elements();let d=l(null),u=l(null),m=l(null);const v=y().props.value.user.full_name;function k(){_.value.open(),setTimeout(function(){helpers.lg("test"),d=x.create("cardNumber"),u=x.create("cardExpiry"),m=x.create("cardCvc"),d.mount("#stripe-card-number"),u.mount("#stripe-card-expiry"),m.mount("#stripe-card-cvc")},200)}function B(){d.destroy(),u.destroy(),m.destroy()}async function C(){const{paymentMethod:f,error:p}=await g.createPaymentMethod("card",d,{billing_details:{name:v.value}});p?helpers.flash({type:"error",message:"Completa correttamente i campi"}):D.Inertia.post(route("customer.updatePaymentMethod"),{pmethod:f.id},{onSuccess:r=>{helpers.flash({type:"success",message:"Metodo di pagamento aggiornato correttamente"}),_.value.close(),D.Inertia.visit(route("plan.detail"))}})}return(f,p)=>{const r=h("bb-label"),Y=h("bb-input"),P=h("BbButton"),$=h("BbDialog");return o(),a("div",null,[t("button",{class:"bb-button-rounded-primary-light p-2",onClick:k},[s(b(O),{class:"w-5 h-5"})]),s($,{ref_key:"dialog",ref:_,type:"plain",size:"lg",onClose:B},{title:e(()=>[z]),buttons:e(()=>[s(P,{primary:"",onClick:C},{default:e(()=>[W]),_:1})]),default:e(()=>[t("div",U,[t("div",null,[s(r,{class:"mb-1"},{default:e(()=>[A]),_:1}),s(Y,{modelValue:b(v),"onUpdate:modelValue":p[0]||(p[0]=N=>V(v)?v.value=N:null),type:"text",placeholder:"Mario Bianchi"},null,8,["modelValue"])]),t("div",null,[s(r,{class:"mb-1"},{default:e(()=>[T]),_:1}),q]),t("div",null,[s(r,{class:"mb-1"},{default:e(()=>[K]),_:1}),F]),t("div",null,[s(r,{class:"mb-1"},{default:e(()=>[L]),_:1}),R])])]),_:1},512)])}}},G={key:0,class:"max-w-2xl mx-auto"},H=t("h1",{class:"text-3xl font-black text-bb-primary text-center mb-8"}," Dettagli dell'abbonamento ",-1),J={class:"bb-card shadow-md p-8 mb-8"},Q={class:"bb-info-list"},Z={class:"bb-info-list__tile"},tt=t("div",null,"Abbonamento",-1),et={class:"flex items-center space-x-4"},ot={class:"uppercase font-bold"},st={class:"bb-info-list__tile"},nt=t("div",null,"Prezzo",-1),at={key:0,class:"font-bold"},it={key:1,class:"font-bold"},lt={class:"bb-info-list__tile"},ct=t("div",null,"Metodo di pagamento",-1),dt={class:"flex items-center space-x-4"},rt={key:0,class:"font-bold"},_t={key:0,class:"bb-info-list__tile"},ut=t("div",{class:"text-bb-danger"},"Scade il ",-1),mt={class:"font-bold text-bb-danger"},pt={key:1,class:"bb-info-list__tile"},bt=t("div",null,"Prossimo rinnovo",-1),ht={class:"font-bold"},vt={key:1,class:"bb-info-list__tile"},ft=t("div",{class:"text-bb-danger"},"Scade il ",-1),yt={class:"font-bold text-bb-danger"},gt={class:"bb-info-list__tile"},xt=t("div",null,"Ultimo pagamento",-1),Dt={class:"font-bold"},kt=c("Disdici abbonamento"),Mt=c(" Cancella Abbonamento "),Bt=t("span",null,"Sei sicuro di voler disdire l'abbonamento?",-1),Ct=c(" Si "),Yt={key:1,class:"flex flex-col items-center space-y-8"},Pt=t("h1",{class:"text-3xl font-black text-bb-primary"}," Non c'\xE8 nessun abbonamento attivo ",-1),St=c("Torna alla home"),Ut={__name:"Edit",props:{plan:Object,price:Object,subscription:Object,lastPaymentDate:Object,nextPaymentDate:String},setup(i){const _=i,g=l(y().props.value.promo_name),x=l(y().props.value.promo_expires);I(()=>{helpers.lg(y().props.value.customer.default_payment_method)});const d=l(null),u=l(y().props.value.customer.subscription_ends_at),m=l(y().props.value.customer.default_payment_method);function v(){d.value.open()}function k(){return Math.round(_.price.price)}function B(){switch(_.price.duration_qty+":"+_.price.duration_type){case"1:month":return"mese";case"3:month":return"3 mesi";case"6:month":return"6 mesi";case"1:year":return"anno";default:return"-"}}function C(){D.Inertia.post(route("customer.subscription.cancel"),{},{onSuccess:f=>{d.value.close(),helpers.flash(f)}})}return(f,p)=>{const r=h("bb-button"),Y=h("BbButton"),P=h("BbDialog");return o(),w(E,{title:"Dettaglio abbonamento"},{default:e(()=>[i.plan?(o(),a("div",G,[H,t("div",J,[t("div",Q,[t("div",Z,[tt,t("div",et,[t("div",ot,n(i.plan.name),1),S("",!0)])]),t("div",st,[nt,i.plan.name!==g.value?(o(),a("div",at,n(k())+" \u20AC/ "+n(B()),1)):(o(),a("div",it,n(k())+" \u20AC ",1))]),t("div",lt,[ct,t("div",dt,[m.value?(o(),a("div",rt,n(m.value.card.brand)+" *********"+n(m.value.card.last4),1)):S("",!0),s(X)])]),i.plan.name!==g.value?(o(),a(j,{key:0},[u.value?(o(),a("div",_t,[ut,t("div",mt,n(b(M)(u.value).format("DD/MM/YYYY")),1)])):(o(),a("div",pt,[bt,t("div",ht,n(b(M)(i.nextPaymentDate).format("DD/MM/YYYY")),1)]))],64)):(o(),a("div",vt,[ft,t("div",yt,n(b(M)(x.value).format("DD/MM/YYYY")),1)])),t("div",gt,[xt,t("div",Dt,n(b(M)(i.lastPaymentDate).format("DD/MM/YYYY")),1)])])]),u.value===null&&i.plan.id!==1?(o(),w(r,{key:0,onClick:v,danger:"",light:"",class:"w-full"},{default:e(()=>[kt]),_:1})):S("",!0),s(P,{ref_key:"deleteDialog",ref:d,type:"plain",size:"sm"},{title:e(()=>[Mt]),buttons:e(()=>[s(Y,{danger:"",onClick:C},{default:e(()=>[Ct]),_:1})]),default:e(()=>[Bt]),_:1},512)])):(o(),a("div",Yt,[Pt,s(r,{secondary:"",onClick:p[1]||(p[1]=$=>b(D.Inertia).visit("/"))},{default:e(()=>[St]),_:1})]))]),_:1})}}};export{Ut as default};
